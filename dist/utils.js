System.register(["lodash"], function (exports_1, context_1) {
    "use strict";
    var lodash_1;
    var __moduleName = context_1 && context_1.id;
    function GetDecimalsForValue(value, panelDecimals) {
        if (lodash_1.default.isNumber(panelDecimals)) {
            return { decimals: panelDecimals, scaledDecimals: null };
        }
        var delta = value / 2;
        var dec = -Math.floor(Math.log(delta) / Math.LN10);
        var magn = Math.pow(10, -dec), norm = delta / magn, size;
        if (norm < 1.5) {
            size = 1;
        }
        else if (norm < 3) {
            size = 2;
            if (norm > 2.25) {
                size = 2.5;
                ++dec;
            }
        }
        else if (norm < 7.5) {
            size = 5;
        }
        else {
            size = 10;
        }
        size *= magn;
        if (Math.floor(value) === value) {
            dec = 0;
        }
        var result = {
            decimals: 0,
            scaledDecimals: 0,
        };
        result.decimals = Math.max(0, dec);
        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;
        return result;
    }
    exports_1("GetDecimalsForValue", GetDecimalsForValue);
    function getTextSizeForWidth(text, font, width, minFontPx, maxFontPx) {
        var s = font.replace("?", maxFontPx);
        var w = getTextWidth(text, s);
        if (w <= width) {
            return maxFontPx;
        }
        width = width - 20;
        for (var fontSize = maxFontPx; fontSize >= minFontPx; fontSize--) {
            s = font.replace("?", fontSize);
            w = getTextWidth(text, s);
            if (w < width) {
                return Math.ceil(fontSize);
            }
        }
        return 0;
    }
    exports_1("getTextSizeForWidth", getTextSizeForWidth);
    function getTextSizeForWidthAndHeight(text, font, width, height, minFontPx, maxFontPx) {
        var s = font.replace("?", maxFontPx);
        var w = getTextWidth(text, s);
        width = width * 0.8;
        if ((w <= width) && (maxFontPx <= height)) {
            return maxFontPx;
        }
        for (var fontSize = maxFontPx; fontSize >= minFontPx; fontSize--) {
            s = font.replace("?", fontSize);
            w = getTextWidth(text, s);
            if ((w < width) && (fontSize <= height)) {
                return Math.ceil(fontSize);
            }
        }
        return 0;
    }
    exports_1("getTextSizeForWidthAndHeight", getTextSizeForWidthAndHeight);
    function getTextWidth(text, font) {
        var canvas = document.createElement("canvas");
        var context = canvas.getContext("2d");
        context.font = font;
        var metrics = context.measureText(text);
        return metrics.width;
    }
    exports_1("getTextWidth", getTextWidth);
    function RGBToHex(text) {
        if (!text.startsWith("rgb")) {
            return text;
        }
        var hex = "#FFFFFF";
        try {
            var a = text.split("(")[1].split(")")[0];
            var b = a.split(",");
            var c = b.map(function (x) {
                x = parseInt(x, 10).toString(16);
                return (x.length === 1) ? "0" + x : x;
            });
            hex = "#" + c.join("");
        }
        catch (e) {
            return hex;
        }
        return hex;
    }
    exports_1("RGBToHex", RGBToHex);
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            }
        ],
        execute: function () {
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztJQU1BLFNBQVMsbUJBQW1CLENBQUMsS0FBVSxFQUFFLGFBQWtCO1FBQ3pELElBQUksZ0JBQUMsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUU7WUFDN0IsT0FBTyxFQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBQyxDQUFDO1NBQ3hEO1FBRUQsSUFBSSxLQUFLLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFDekIsSUFBSSxHQUFHLEtBQUssR0FBRyxJQUFJLEVBQ25CLElBQUksQ0FBQztRQUVULElBQUksSUFBSSxHQUFHLEdBQUcsRUFBRTtZQUNkLElBQUksR0FBRyxDQUFDLENBQUM7U0FDVjthQUFNLElBQUksSUFBSSxHQUFHLENBQUMsRUFBRTtZQUNuQixJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBRVQsSUFBSSxJQUFJLEdBQUcsSUFBSSxFQUFFO2dCQUNmLElBQUksR0FBRyxHQUFHLENBQUM7Z0JBQ1gsRUFBRSxHQUFHLENBQUM7YUFDUDtTQUNGO2FBQU0sSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFO1lBQ3JCLElBQUksR0FBRyxDQUFDLENBQUM7U0FDVjthQUFNO1lBQ0wsSUFBSSxHQUFHLEVBQUUsQ0FBQztTQUNYO1FBRUQsSUFBSSxJQUFJLElBQUksQ0FBQztRQUdiLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLEVBQUU7WUFBRSxH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QUFPLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hDLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQztJQUN2QixDQUFDOztJQUVELFNBQVMsUUFBUSxDQUFDLElBQVk7UUFFNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0IsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQUksR0FBRyxHQUFHLFNBQVMsQ0FBQztRQUNwQixJQUFJO1lBQ0YsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVMsQ0FBQztnQkFDdEIsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNqQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLENBQUMsQ0FBQyxDQUFDO1lBQ0gsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3hCO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDVixPQUFPLEdBQUcsQ0FBQztTQUNaO1FBQ0QsT0FBTyxHQUFHLENBQUM7SUFDYixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8vLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9ub2RlX21vZHVsZXMvQHR5cGVzL2xvZGFzaC9pbmRleC5kLnRzXCIgLz5cblxuLy8gaW1wb3J0IHsgaXNOdW1iZXIgfSBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG4vL2ltcG9ydCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcblxuZnVuY3Rpb24gR2V0RGVjaW1hbHNGb3JWYWx1ZSh2YWx1ZTogYW55LCBwYW5lbERlY2ltYWxzOiBhbnkpOiB7IGRlY2ltYWxzOyBzY2FsZWREZWNpbWFsczsgfSB7XG4gIGlmIChfLmlzTnVtYmVyKHBhbmVsRGVjaW1hbHMpKSB7XG4gICAgcmV0dXJuIHtkZWNpbWFsczogcGFuZWxEZWNpbWFscywgc2NhbGVkRGVjaW1hbHM6IG51bGx9O1xuICB9XG5cbiAgdmFyIGRlbHRhID0gdmFsdWUgLyAyO1xuICB2YXIgZGVjID0gLU1hdGguZmxvb3IoTWF0aC5sb2coZGVsdGEpIC8gTWF0aC5MTjEwKTtcblxuICB2YXIgbWFnbiA9IE1hdGgucG93KDEwLCAtZGVjKSxcbiAgICAgIG5vcm0gPSBkZWx0YSAvIG1hZ24sIC8vIG5vcm0gaXMgYmV0d2VlbiAxLjAgYW5kIDEwLjBcbiAgICAgIHNpemU7XG5cbiAgaWYgKG5vcm0gPCAxLjUpIHtcbiAgICBzaXplID0gMTtcbiAgfSBlbHNlIGlmIChub3JtIDwgMykge1xuICAgIHNpemUgPSAyO1xuICAgIC8vIHNwZWNpYWwgY2FzZSBmb3IgMi41LCByZXF1aXJlcyBhbiBleHRyYSBkZWNpbWFsXG4gICAgaWYgKG5vcm0gPiAyLjI1KSB7XG4gICAgICBzaXplID0gMi41O1xuICAgICAgKytkZWM7XG4gICAgfVxuICB9IGVsc2UgaWYgKG5vcm0gPCA3LjUpIHtcbiAgICBzaXplID0gNTtcbiAgfSBlbHNlIHtcbiAgICBzaXplID0gMTA7XG4gIH1cblxuICBzaXplICo9IG1hZ247XG5cbiAgLy8gcmVkdWNlIHN0YXJ0aW5nIGRlY2ltYWxzIGlmIG5vdCBuZWVkZWRcbiAgaWYgKE1hdGguZmxvb3IodmFsdWUpID09PSB2YWx1ZSkgeyBkZWMgPSAwOyB9XG5cbiAgdmFyIHJlc3VsdCA9IHtcbiAgICBkZWNpbWFsczogMCxcbiAgICBzY2FsZWREZWNpbWFsczogMCxcbiAgfTtcbiAgcmVzdWx0LmRlY2ltYWxzID0gTWF0aC5tYXgoMCwgZGVjKTtcbiAgcmVzdWx0LnNjYWxlZERlY2ltYWxzID0gcmVzdWx0LmRlY2ltYWxzIC0gTWF0aC5mbG9vcihNYXRoLmxvZyhzaXplKSAvIE1hdGguTE4xMCkgKyAyO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqXG4gKlxuICogRmluZCB0aGUgbGFyZ2VzdCBmb250IHNpemUgKGluIHBpeGVscykgdGhhdCBhbGxvd3MgdGhlIHN0cmluZyB0byBmaXQgaW4gdGhlIGdpdmVuIHdpZHRoLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIGJlIHJlbmRlcmVkLlxuICogQHBhcmFtIHtTdHJpbmd9IGZvbnQgVGhlIGNzcyBmb250IGRlc2NyaXB0b3IgdGhhdCB0ZXh0IGlzIHRvIGJlIHJlbmRlcmVkIHdpdGggKGUuZy4gXCJib2xkID9weCB2ZXJkYW5hXCIpXG4gKiAgICAgICAgICAgICAgICAgICAgICAtLSBub3RlIHRoZSB1c2Ugb2YgPyBpbiBwbGFjZSBvZiB0aGUgZm9udCBzaXplLlxuICogQHBhcmFtIHt3aWR0aH0gdGhlIHdpZHRoIGluIHBpeGVscyB0aGUgc3RyaW5nIG11c3QgZml0IGluXG4gKiBAcGFyYW0ge21pbkZvbnRQeH0gdGhlIHNtYWxsZXN0IGFjY2VwdGFibGUgZm9udCBzaXplIGluIHBpeGVsc1xuICogQHBhcmFtIHttYXhGb250UHh9IHRoZSBsYXJnZXN0IGFjY2VwdGFibGUgZm9udCBzaXplIGluIHBpeGVsc1xuKiovXG5mdW5jdGlvbiBnZXRUZXh0U2l6ZUZvcldpZHRoKHRleHQ6IHN0cmluZywgZm9udDogYW55LCB3aWR0aCwgbWluRm9udFB4LCBtYXhGb250UHgpIHtcbiAgICB2YXIgcyA9IGZvbnQucmVwbGFjZShcIj9cIiwgbWF4Rm9udFB4KTtcbiAgICB2YXIgdyA9IGdldFRleHRXaWR0aCh0ZXh0LCBzKTtcbiAgICBpZiAodyA8PSB3aWR0aCkge1xuICAgICAgcmV0dXJuIG1heEZvbnRQeDtcbiAgICB9XG4gICAgLy8gcGFkIHdpZHRoIGJ5IDEwcHhcbiAgICB3aWR0aCA9IHdpZHRoIC0gMjA7XG4gICAgLy8gc3RhcnQgZnJvbSBsYXJnZSB0byBzbWFsbCwgcmV0dXJuIDAgZm9yIG5vLWZpdFxuICAgIGZvciAobGV0IGZvbnRTaXplID0gbWF4Rm9udFB4OyBmb250U2l6ZSA+PSBtaW5Gb250UHg7IGZvbnRTaXplLS0pIHtcbiAgICAgIHMgPSBmb250LnJlcGxhY2UoXCI/XCIsIGZvbnRTaXplKTtcbiAgICAgIHcgPSBnZXRUZXh0V2lkdGgodGV4dCwgcyk7XG4gICAgICBpZiAodyA8IHdpZHRoKSB7XG4gICAgICAgIHJldHVybiBNYXRoLmNlaWwoZm9udFNpemUpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyAwIGlmIG5vIGZpdFxuICAgIHJldHVybiAwO1xufVxuXG4vKipcbiAqXG4gKlxuICogRmluZCB0aGUgbGFyZ2VzdCBmb250IHNpemUgKGluIHBpeGVscykgdGhhdCBhbGxvd3MgdGhlIHN0cmluZyB0byBmaXQgaW4gdGhlIGdpdmVuIHdpZHRoLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIGJlIHJlbmRlcmVkLlxuICogQHBhcmFtIHtTdHJpbmd9IGZvbnQgVGhlIGNzcyBmb250IGRlc2NyaXB0b3IgdGhhdCB0ZXh0IGlzIHRvIGJlIHJlbmRlcmVkIHdpdGggKGUuZy4gXCJib2xkID9weCB2ZXJkYW5hXCIpXG4gKiAgICAgICAgICAgICAgICAgICAgICAtLSBub3RlIHRoZSB1c2Ugb2YgPyBpbiBwbGFjZSBvZiB0aGUgZm9udCBzaXplLlxuICogQHBhcmFtIHt3aWR0aH0gdGhlIHdpZHRoIGluIHBpeGVscyB0aGUgc3RyaW5nIG11c3QgZml0IGluXG4gKiBAcGFyYW0ge2hlaWdodH0gdGhlIGhlaWdodCBpbiBwaXhlbHNcbiAqIEBwYXJhbSB7bWluRm9udFB4fSB0aGUgc21hbGxlc3QgYWNjZXB0YWJsZSBmb250IHNpemUgaW4gcGl4ZWxzXG4gKiBAcGFyYW0ge21heEZvbnRQeH0gdGhlIGxhcmdlc3QgYWNjZXB0YWJsZSBmb250IHNpemUgaW4gcGl4ZWxzXG4qKi9cbmZ1bmN0aW9uIGdldFRleHRTaXplRm9yV2lkdGhBbmRIZWlnaHQodGV4dDogc3RyaW5nLCBmb250OiBhbnksIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBtaW5Gb250UHg6IG51bWJlciwgbWF4Rm9udFB4OiBudW1iZXIpIHtcbiAgdmFyIHMgPSBmb250LnJlcGxhY2UoXCI/XCIsIG1heEZvbnRQeCk7XG4gIHZhciB3ID0gZ2V0VGV4dFdpZHRoKHRleHQsIHMpO1xuICAvLyBuZWVkIHRvIHBhZCB0aGUgd2lkdGg6IHVzZSA4MCUgb2YgdGhlIHNwYWNlIChsZWF2ZSAxMCUgcGFkZGluZyBvbiBlYWNoIHNpZGUpXG4gIHdpZHRoID0gd2lkdGggKiAwLjg7XG4gIC8vY29uc29sZS5sb2coXCJFc3RpbWF0aW5nIHNpemUgZm9yIHRleHQ6IFwiICsgdGV4dCArIFwiIGluc2lkZSB3aWR0aDogXCIgKyB3aWR0aCArIFwiIHVzaW5nIGZvbnQ6IFwiICsgZm9udCk7XG4gIGlmICgodyA8PSB3aWR0aCkgJiYgKG1heEZvbnRQeCA8PSBoZWlnaHQpKSB7XG4gICAgcmV0dXJuIG1heEZvbnRQeDtcbiAgfVxuICAvLyBzdGFydCBmcm9tIGxhcmdlIHRvIHNtYWxsLCByZXR1cm4gMCBmb3Igbm8tZml0XG4gIGZvciAobGV0IGZvbnRTaXplID0gbWF4Rm9udFB4OyBmb250U2l6ZSA+PSBtaW5Gb250UHg7IGZvbnRTaXplLS0pIHtcbiAgICBzID0gZm9udC5yZXBsYWNlKFwiP1wiLCBmb250U2l6ZSk7XG4gICAgdyA9IGdldFRleHRXaWR0aCh0ZXh0LCBzKTtcbiAgICAvL2NvbnNvbGUubG9nKFwiY2FsYyB3aWR0aCA9IFwiICsgdyk7XG4gICAgLy8gaGFzIHRvIGZpdCB3aXRoaW4gdGhlIHdpZHRoIG9mIHRoZSB0ZXh0IGFyZWEsIGFuZCBub3QgZXhjZWVkIHRoZSBoZWlnaHRcbiAgICBpZiAoKHcgPCB3aWR0aCkgJiYgKGZvbnRTaXplIDw9IGhlaWdodCkpIHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJlc3RpbWF0ZWQgc2l6ZTogXCIgKyBNYXRoLmNlaWwoZm9udFNpemUpKTtcbiAgICAgIHJldHVybiBNYXRoLmNlaWwoZm9udFNpemUpO1xuICAgIH1cbiAgfVxuICAvLyAwIGlmIG5vIGZpdFxuICByZXR1cm4gMDtcbn1cblxuLyoqXG4gKiBVc2VzIGNhbnZhcy5tZWFzdXJlVGV4dCB0byBjb21wdXRlIGFuZCByZXR1cm4gdGhlIHdpZHRoIG9mIHRoZSBnaXZlbiB0ZXh0IG9mIGdpdmVuIGZvbnQgaW4gcGl4ZWxzLlxuICpcbiAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSB0ZXh0IHRvIGJlIHJlbmRlcmVkLlxuICogQHBhcmFtIHtTdHJpbmd9IGZvbnQgVGhlIGNzcyBmb250IGRlc2NyaXB0b3IgdGhhdCB0ZXh0IGlzIHRvIGJlIHJlbmRlcmVkIHdpdGggKGUuZy4gXCJib2xkIDE0cHggdmVyZGFuYVwiKS5cbiAqXG4gKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExODI0MS9jYWxjdWxhdGUtdGV4dC13aWR0aC13aXRoLWphdmFzY3JpcHQvMjEwMTUzOTMjMjEwMTUzOTNcbiAqL1xuZnVuY3Rpb24gZ2V0VGV4dFdpZHRoKHRleHQ6IHN0cmluZywgZm9udDogc3RyaW5nKSB7XG4gIC8vIHJlLXVzZSBjYW52YXMgb2JqZWN0IGZvciBiZXR0ZXIgcGVyZm9ybWFuY2VcbiAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIHZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgY29udGV4dC5mb250ID0gZm9udDtcbiAgdmFyIG1ldHJpY3MgPSBjb250ZXh0Lm1lYXN1cmVUZXh0KHRleHQpO1xuICByZXR1cm4gbWV0cmljcy53aWR0aDtcbn1cblxuZnVuY3Rpb24gUkdCVG9IZXgodGV4dDogc3RyaW5nKSB7XG4gIC8vIGNoZWNrIGlmIGluIHJnYiBub3RhdGlvblxuICBpZiAoIXRleHQuc3RhcnRzV2l0aChcInJnYlwiKSkge1xuICAgIHJldHVybiB0ZXh0O1xuICB9XG4gIGxldCBoZXggPSBcIiNGRkZGRkZcIjtcbiAgdHJ5IHtcbiAgICBsZXQgYSA9IHRleHQuc3BsaXQoXCIoXCIpWzFdLnNwbGl0KFwiKVwiKVswXTtcbiAgICBsZXQgYiA9IGEuc3BsaXQoXCIsXCIpO1xuICAgIGxldCBjID0gYi5tYXAoZnVuY3Rpb24oeCkgeyAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIGFycmF5IGVsZW1lbnRcbiAgICAgIHggPSBwYXJzZUludCh4LCAxMCkudG9TdHJpbmcoMTYpOyAgICAgICAvLyBDb252ZXJ0IHRvIGEgYmFzZTE2IHN0cmluZ1xuICAgICAgcmV0dXJuICh4Lmxlbmd0aCA9PT0gMSkgPyBcIjBcIiArIHggOiB4OyAgLy8gQWRkIHplcm8gaWYgd2UgZ2V0IG9ubHkgb25lIGNoYXJhY3RlclxuICAgIH0pO1xuICAgIGhleCA9IFwiI1wiICsgYy5qb2luKFwiXCIpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIGhleDtcbiAgfVxuICByZXR1cm4gaGV4O1xufVxuXG5leHBvcnQge1xuR2V0RGVjaW1hbHNGb3JWYWx1ZSxcbmdldFRleHRTaXplRm9yV2lkdGgsXG5nZXRUZXh0U2l6ZUZvcldpZHRoQW5kSGVpZ2h0LFxuZ2V0VGV4dFdpZHRoLFxuUkdCVG9IZXhcbn07XG4iXX0=