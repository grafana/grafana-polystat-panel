/*! For license information please see module.js.LICENSE.txt */
define(["lodash","@grafana/data","d3","app/core/utils/kbn","jquery","app/plugins/sdk","@grafana/ui","app/core/time_series2","app/core/core_module"],(function(t,e,a,i,o,r,s,n,l){return function(t){var e={};function a(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(i,o,function(e){return t[e]}.bind(null,o));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=11)}([function(e,a){e.exports=t},function(t,a){t.exports=e},function(t,e){t.exports=a},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e){t.exports=r},function(t,e){t.exports=s},function(t,e){t.exports=n},function(t,e){t.exports=l},,,function(t,e,a){"use strict";a.r(e);var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};var o=function(){return(o=Object.assign||function(t){for(var e,a=1,i=arguments.length;a<i;a++)for(var o in e=arguments[a])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function r(t,e){var a="function"==typeof Symbol&&t[Symbol.iterator];if(!a)return t;var i,o,r=a.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(a=r.return)&&a.call(r)}finally{if(o)throw o.error}}return s}var s=a(5),n=a(0),l=a.n(n),h=a(4),p=a.n(h),u=a(3),c=a.n(u),d=a(7),m=a.n(d),f=a(1),v=a(2),g=Math.PI/3,y=[0,g,2*g,3*g,4*g,5*g];function b(t){return t[0]}function x(t){return t[1]}function w(t,e){if(l.a.isNumber(e))return{decimals:e,scaledDecimals:null};var a,i=t/2,o=-Math.floor(Math.log(i)/Math.LN10),r=Math.pow(10,-o),s=i/r;s<1.5?a=1:s<3?(a=2,s>2.25&&(a=2.5,++o)):a=s<7.5?5:10,a*=r,Math.floor(t)===t&&(o=0);var n={decimals:0,scaledDecimals:0};return n.decimals=Math.max(0,o),n.scaledDecimals=n.decimals-Math.floor(Math.log(a)/Math.LN10)+2,n}function C(t,e){var a=document.createElement("canvas").getContext("2d");return a.font=e,a.measureText(t).width}function S(t){if(!t.startsWith("rgb"))return t;var e="#FFFFFF";try{e="#"+t.split("(")[1].split(")")[0].split(",").map((function(t){return 1===(t=parseInt(t,10).toString(16)).length?"0"+t:t})).join("")}catch(t){return e}return e}var T,R=function(){function t(t,e,a){this.r=t,this.g=e,this.b=a}return t.prototype.asHex=function(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},t.prototype.asRGB=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},t.prototype.blendWith=function(e,a){return new t(Math.round(e.r*(1-a)+this.r*a),Math.round(e.g*(1-a)+this.g*a),Math.round(e.b*(1-a)+this.b*a))},t.prototype.Mul=function(e,a){return new t(Math.round(e.r/255*this.r*a),Math.round(e.g/255*this.g*a),Math.round(e.b/255*this.b*a))},t.prototype.RGBToHex=function(t){var e=t.indexOf(",")>-1?",":" ";for(var a in t=t.substr(4).split(")")[0].split(e)){var i=t[a];i.indexOf("%")>-1&&(t[a]=Math.round(i.substr(0,i.length-1)/100*255))}},t.RGBAToHex=function(t){var e,a=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),i=(a&&a[4]||"").trim(),o=a?(256|parseInt(a[1],10)).toString(16).slice(1)+(256|parseInt(a[2],10)).toString(16).slice(1)+(256|parseInt(a[3],10)).toString(16).slice(1):t;""!==i?e=(255*parseFloat(i)|256).toString(16).slice(1):e=1;return"#"+o+e},t.prototype.fromHex=function(t){t=t.substring(1,7);var e=parseInt(t,16);this.r=e>>16&255,this.g=e>>8&255,this.b=255&e},t.createGradients=function(e){for(var a=[],i=new t(255,255,255),o=0;o<e.length;o++){var r=new t(0,0,0),s=e[o].color;s.startsWith("rgba")&&(s=this.RGBAToHex(s)),r.fromHex(s);var n=r.Mul(i,.7);a.push({start:r.asHex(),end:n.asHex()})}return a},t}(),D=function(){};!function(t){t.HEXAGON_POINTED_TOP="hexagon_pointed_top",t.CIRCLE="circle",t.SQUARE="square"}(T||(T={}));var M=function(){function t(t,e,a,i,o,r,s){this.SQRT3=1.7320508075688772,this.width=t,this.height=e,this.numColumns=a,this.numRows=i,this.maxColumnsUsed=0,this.maxRowsUsed=0,this.displayLimit=o,this.shape=s,this.radius=0,this.autoSize=r}return t.prototype.setRadius=function(t){this.radius=t},t.prototype.setHeight=function(t){this.height=t},t.prototype.setWidth=function(t){this.width=t},t.prototype.generateHexagonPointedTopLayout=function(){return this.radius=this.getHexFlatTopRadius(),{}},t.prototype.generateUniformLayout=function(){return this.radius=this.getUniformRadius(),{}},t.prototype.getHexFlatTopRadius=function(){var t=v.min([this.width/((this.numColumns+.5)*this.SQRT3),this.height/(1.5*(this.numRows+1/3))]);return t-=0,this.truncateFloat(t)},t.prototype.getHexFlatTopDiameters=function(){var t=this.getHexFlatTopRadius();return{diameterX:this.truncateFloat(t*this.SQRT3),diameterY:this.truncateFloat(2*t)}},t.prototype.getUniformDiameters=function(){var t=this.getUniformRadius();return{diameterX:2*t,diameterY:2*t}},t.prototype.getUniformRadius=function(){var t=this.width/this.maxColumnsUsed*.5,e=this.height/this.maxRowsUsed*.5,a=t;return a>e&&(a=e),a-=0,this.truncateFloat(a)},t.prototype.generatePossibleColumnAndRowsSizes=function(t,e,a){if(e&&t){var i=Math.sqrt(a);this.width>this.height?(this.numColumns=Math.ceil(this.width/this.height*i),this.numColumns<1?this.numColumns=1:this.numColumns>a&&(this.numColumns=a),this.numRows=Math.ceil(a/this.numColumns),this.numRows<1&&(this.numRows=1)):(this.numRows=Math.ceil(this.height/this.width*i),this.numRows<1?this.numRows=1:this.numRows>a&&(this.numRows=a),this.numColumns=Math.ceil(a/this.numRows),this.numColumns<1&&(this.numColumns=1))}else e?(this.numRows=Math.ceil(a/this.numColumns),this.numRows<1&&(this.numRows=1)):t&&(this.numColumns=Math.ceil(a/this.numRows),this.numColumns<1&&(this.numColumns=1))},t.prototype.generateActualColumnAndRowUsage=function(t,e){for(var a=0,i=0,o=0,r=0,s=0;s<this.numRows;s++)if((!e||a<e)&&a<t.length){i+=1,o=0;for(var n=0;n<this.numColumns;n++)(!e||a<e)&&a<t.length&&((o+=1)>r&&(r=o),a++)}this.maxRowsUsed=i,this.maxColumnsUsed=r},t.prototype.shapeToCoordinates=function(t,e,a,i){switch(t){case T.HEXAGON_POINTED_TOP:var o=e*a*this.SQRT3;return i%2==1&&(o+=e*this.SQRT3/2),[o,e*i*1.5];case T.CIRCLE:case T.SQUARE:return[e*a*2,e*i*2];default:return[e*a*1.75,e*i*1.5]}},t.prototype.generatePoints=function(t,e,a){var i=[];if(void 0===t)return i;var o=0,r=0,s=0;if(this.numRows===1/0)return i;if(isNaN(this.numColumns))return i;for(var n=0;n<this.numRows;n++)if((!e||i.length<e)&&i.length<t.length){o+=1,r=0;for(var l=0;l<this.numColumns;l++)(!e||i.length<e)&&i.length<t.length&&((r+=1)>s&&(s=r),i.push(this.shapeToCoordinates(a,this.radius,l,n)))}return this.maxRowsUsed=o,this.maxColumnsUsed=s,i},t.prototype.generateUniformPoints=function(t,e){var a=[];if(void 0===t)return a;var i=0,o=0,r=0,s=1,n=1;if(this.numRows===1/0)return a;if(isNaN(this.numColumns))return a;for(var l=0;l<this.numRows;l++)if((!e||a.length<e)&&a.length<t.length){i+=1,o=0;for(var h=0;h<this.numColumns;h++)(!e||a.length<e)&&a.length<t.length&&((o+=1)>r&&(r=o),a.push({x:s,y:n,width:2*this.radius,height:2*this.radius}),s+=2*this.radius);s=1,n+=2*this.radius}return this.maxRowsUsed=i,this.maxColumnsUsed=r,a},t.prototype.getRadius=function(){return this.radius},t.prototype.generateRadius=function(t){if(!this.autoSize)return this.radius;var e=0;switch(t){case T.HEXAGON_POINTED_TOP:e=this.getHexFlatTopRadius();break;case T.CIRCLE:case T.SQUARE:e=this.getUniformRadius();break;default:e=this.getHexFlatTopRadius()}return this.radius=e,e},t.prototype.truncateFloat=function(t){if(t===1/0||isNaN(t))return 0;var e=t.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];return Number(e)},t.prototype.getOffsets=function(t,e){switch(t){case T.HEXAGON_POINTED_TOP:return this.getOffsetsHexagonPointedTop(e);case T.SQUARE:return this.getOffsetsSquare(e);case T.CIRCLE:default:return this.getOffsetsUniform(e)}},t.prototype.getOffsetsHexagonPointedTop=function(t){var e=v.min([this.width/((this.numColumns+.5)*this.SQRT3),this.height/(1.5*(this.numRows+1/3))]);e=this.truncateFloat(e);var a=this.truncateFloat(e*this.SQRT3),i=this.truncateFloat(2*e),o=.5*i,r=this.getOddEvenCountForRange(1,this.maxRowsUsed),s=r.oddCount*i+r.evenCount*i*.5,n=(this.height-s)/2;n=-(n+o);var l=.5*a,h=0;this.numRows>1&&t>=2*this.maxColumnsUsed&&(h=.5);var p=(this.numColumns+h)*a,u=(this.width-p)/2;return{xoffset:u=-(u+l),yoffset:n}},t.prototype.getOffsetsUniform=function(t){var e=this.getDiameters(),a=e.diameterX,i=e.diameterY,o=this.truncateFloat(a),r=this.truncateFloat(i),s=.5*r,n=this.maxRowsUsed*r,l=(this.height-n)/2;l=-(l+s);var h=.5*o,p=this.numColumns*o,u=(this.width-p)/2;return{xoffset:u=-(u+h),yoffset:l}},t.prototype.getOffsetsSquare=function(t){var e=this.getDiameters(),a=e.diameterX,i=e.diameterY,o=this.truncateFloat(a),r=this.truncateFloat(i),s=this.maxRowsUsed*r,n=(this.height-s)/2;n=-(n+0);var l=this.numColumns*o,h=(this.width-l)/2;return{xoffset:h=-(h+0),yoffset:n}},t.prototype.getOddEvenCountForRange=function(t,e){var a=(e-t)/2;return e%2==0&&t%2==0||a++,{oddCount:a,evenCount:e-t+1-a}},t.prototype.getDiameters=function(){switch(this.shape){case T.HEXAGON_POINTED_TOP:return this.getHexFlatTopDiameters();case T.SQUARE:case T.CIRCLE:default:return this.getUniformDiameters()}},t}();function E(t){return!("showName"in t)||t.showName}function N(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=v.event.pageX-50;return e<0&&(e=0),e+200>t&&(e=t-200),{xpos:e,ypos:v.event.pageY+5}}var O=function(){function t(t,e,a,i){this.minFont=6,this.maxFont=240,this.templateSrv=t,this.svgContainer=e,this.d3DivId=a,this.data=i.data,this.opt=i,this.purelight=new R(255,255,255),this.data=this.opt.data,this.lm=new M(this.opt.width,this.opt.height,i.columns||6,i.rows||6,this.opt.displayLimit,this.opt.radiusAutoSize,this.opt.polystat.shape),this.lm.generatePossibleColumnAndRowsSizes(this.opt.columnAutoSize,this.opt.rowAutoSize,this.data.length),this.lm.generateActualColumnAndRowUsage(this.data,i.displayLimit),!i.radiusAutoSize&&i.radius?this.lm.setRadius(i.radius):this.lm.generateRadius(this.opt.polystat.shape),this.calculatedPoints=this.lm.generatePoints(this.data,i.displayLimit,this.opt.polystat.shape)}return t.prototype.computeTextFontSize=function(t,e,a,i){return function(t,e,a,i,o,r){var s=e.replace("?",r),n=C(t,s);if(n<=(a*=.95)&&r<=i)return r;for(var l=r;l>=o;l--)if((n=C(t,s=e.replace("?",l)))<a&&l<=i)return Math.ceil(l);return 0}(t,"?px sans-serif",a,i/e,this.minFont,this.maxFont)},t.prototype.update=function(t){t&&(this.data=t)},t.prototype.draw=function(){var t=this,e=0,a=0,i=this.opt.width,o=this.opt.height,r=function(){var t,e,a,i=0,o=0,r=1,s=1,n=b,l=x;function h(t){var i,o={},r=[],s=t.length;for(i=0;i<s;++i)if(!isNaN(p=+n.call(null,h=t[i],i,t))&&!isNaN(u=+l.call(null,h,i,t))){var h,p,u,c=Math.round(u/=a),d=Math.round(p=p/e-(1&c)/2),m=u-c;if(3*Math.abs(m)>1){var f=p-d,v=d+(p<d?-1:1)/2,g=c+(u<c?-1:1),y=p-v,b=u-g;f*f+m*m>y*y+b*b&&(d=v+(1&c?1:-1)/2,c=g)}var x=d+"-"+c,w=o[x];w?w.push(h):(r.push(w=o[x]=[h]),w.x=(d+(1&c)/2)*e,w.y=c*a)}return r}function p(t){var e=0,a=0;return y.map((function(i){var o=Math.sin(i)*t,r=-Math.cos(i)*t,s=o-e,n=r-a;return e=o,a=r,[s,n]}))}return h.hexagon=function(e){return"m"+p(null==e?t:+e).join("l")+"z"},h.centers=function(){for(var n=[],l=Math.round(o/a),h=Math.round(i/e),p=l*a;p<s+t;p+=a,++l)for(var u=h*e+(1&l)*e/2;u<r+e/2;u+=e)n.push([u,p]);return n},h.mesh=function(){var e=p(t).slice(0,4).join("l");return h.centers().map((function(t){return"M"+t+"m"+e})).join("")},h.x=function(t){return arguments.length?(n=t,h):n},h.y=function(t){return arguments.length?(l=t,h):l},h.radius=function(i){return arguments.length?(e=2*(t=+i)*Math.sin(g),a=1.5*t,h):t},h.size=function(t){return arguments.length?(i=o=0,r=+t[0],s=+t[1],h):[r-i,s-o]},h.extent=function(t){return arguments.length?(i=+t[0][0],o=+t[0][1],r=+t[1][0],s=+t[1][1],h):[[i,o],[r,s]]},h.radius(1)}().radius(this.lm.generateRadius(this.opt.polystat.shape)).extent([[0,0],[i,o]]),s=this.lm.getDiameters(),n=s.diameterX,l=s.diameterY,h=this.lm.getOffsets(this.opt.polystat.shape,this.data.length),p=h.xoffset,u=h.yoffset,c=v.select("body").append("div").attr("id",this.d3DivId+"-tooltip").attr("class","polystat-panel-tooltip").style("opacity",0);!1===this.opt.polystat.tooltipEnabled&&c.style("display","none");for(var d=v.select(this.svgContainer).attr("width",i+"px").attr("height",o+"px").append("svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").attr("width","100%").attr("height","100%").attr("viewBox",p+","+u+", "+i+", "+o).style("border","0px solid white").attr("id",this.d3DivId).append("g").attr("transform","translate("+a+","+e+")"),m=this.data,f=d.append("defs"),w=R.createGradients(m),C=0;C<w.length;C++){var S=f.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-data-"+C);S.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),S.append("stop").attr("offset","0%").attr("stop-color",w[C].start),S.append("stop").attr("offset","100%").attr("stop-color",w[C].end)}var D=new R(82,194,52),M=D.Mul(this.purelight,.7),O=f.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-ok");O.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),O.append("stop").attr("offset","0%").attr("stop-color",D.asHex()),O.append("stop").attr("offset","100%").attr("stop-color",M.asHex());var F=new R(255,200,55),k=F.Mul(this.purelight,.7),L=f.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-warning");L.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),L.append("stop").attr("offset","0%").attr("stop-color",F.asHex()),L.append("stop").attr("offset","100%").attr("stop-color",k.asHex());var z=new R(229,45,39),P=z.Mul(this.purelight,.7),_=f.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-critical");_.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),_.append("stop").attr("offset","0%").attr("stop-color",z.asHex()),_.append("stop").attr("offset","100%").attr("stop-color",P.asHex());var I=f.append("linearGradient").attr("id",this.d3DivId+"linear-gradient-state-unknown");I.attr("x1","30%").attr("y1","30%").attr("x2","70%").attr("y2","70%"),I.append("stop").attr("offset","0%").attr("stop-color","#73808A"),I.append("stop").attr("offset","100%").attr("stop-color","#757F9A");var A=null,U=n,V=l/2,H=n*l;n<l&&(H=n*n),l<n&&(H=l*l);var $=v.symbol().size(H);switch(this.opt.polystat.shape){case T.HEXAGON_POINTED_TOP:A=r.hexagon(this.lm.getRadius());break;case T.CIRCLE:A=$.type(v.symbolCircle);break;case T.SQUARE:A=$.type(v.symbolSquare);break;default:A=r.hexagon(this.lm.getRadius())}var B=this.opt.polystat.fontSize,j=this.opt.polystat.fontSize,G=!1,W=0;if(this.opt.polystat.fontAutoScale){var Q="";for(C=0;C<this.data.length;C++)this.data[C].name.length>Q.length&&(Q=this.data[C].name);var X="";for(C=0;C<this.data.length;C++){this.data[C].valueFormatted.length>X.length&&(X=this.data[C].valueFormatted);var Y=this.data[C].members.length;if(Y>0)for(var q=0;q<Y;){var J=this.formatValueContent(C,q,this);J&&J.length>X.length&&(X=J),q++}}B=this.computeTextFontSize(Q,2,U,V),j=this.computeTextFontSize(X,2,U,V),B<this.minFont&&(G=!0,W=18,Q=Q.substring(0,W+2),(B=this.computeTextFontSize(Q,2,U,V))<this.minFont&&(W=10,Q=Q.substring(0,W+2),(B=this.computeTextFontSize(Q,2,U,V))<this.minFont&&(W=6,Q=Q.substring(0,W+2),B=this.computeTextFontSize(Q,2,U,V)))),j>B&&(j=B),this.opt.polystat.valueEnabled||(j=0)}var K=V/2/2+j/2,Z=j/2,tt=-V/2/2+B/2,et=B/2,at=0,it=0,ot=this.opt.polystat.shape;d.selectAll("."+ot).data(ot===T.HEXAGON_POINTED_TOP?r(this.calculatedPoints):this.calculatedPoints).enter().each((function(e,a,i){var o,r,s=v.select(i[a]),n=function(t){var e=t.clickThrough;return!0===t.sanitizeURLEnabled&&t.sanitizedURL.length>0&&(e=t.sanitizedURL),e}(m[a]);n.length>0&&(s=s.append("a").attr("target",(o=m[a],r="_self",!0===o.newTabEnabled&&(r="_blank"),r)).attr("xlink:href",n));var l=m[a].color;switch(t.opt.polystat.gradientEnabled&&(l='url("#'+t.d3DivId+"linear-gradient-state-data-"+a+'")'),ot){case T.HEXAGON_POINTED_TOP:s=s.append("path").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).attr("d",A);break;case T.CIRCLE:var h=t.lm.generateRadius(ot);s=s.append("circle").attr("class","circle").attr("cx",(function(t){return t[0]})).attr("cy",(function(t){return t[1]})).attr("r",h);break;case T.SQUARE:var p=t.lm.generateRadius(ot);s=s.append("rect").attr("class","rect").attr("x",(function(t){return t[0]})).attr("y",(function(t){return t[1]})).attr("height",2*p).attr("width",2*p)}s=s.attr("stroke",t.opt.polystat.polygonBorderColor).attr("stroke-width",t.opt.polystat.polygonBorderSize+"px").style("fill",l).on("mousemove",(function(){var t=N(),e=t.xpos,a=t.ypos;c.style("left",e+"px").style("top",a+"px")})).on("mouseover",(function(e){var i=N(),o=i.xpos,r=i.ypos;c.transition().duration(200).style("opacity",.9),c.html(t.opt.tooltipContent[a]).style("font-size",t.opt.tooltipFontSize).style("font-family",t.opt.tooltipFontType).style("left",o+"px").style("top",r+"px")})).on("mouseout",(function(){c.transition().duration(500).style("opacity",0)}))}));var rt=null;switch(this.opt.polystat.shape){case T.HEXAGON_POINTED_TOP:rt=d.selectAll("text.toplabel").data(r(this.calculatedPoints)),et=.37*B;break;case T.CIRCLE:rt=d.selectAll("text.toplabel").data(this.miscbin(this.calculatedPoints)),et=.37*B;break;case T.SQUARE:rt=d.selectAll("text.toplabel").data(this.miscbin(this.calculatedPoints)),K=l/1.5+j/2,Z=l/2+.37*B,tt=l/4+B/2,et=l/2+.37*B,at=n/2,it=n/2}rt.enter().append("text").attr("class","toplabel").attr("x",(function(t){return t.x+at})).attr("y",(function(t,e){var a=m[e],i=et;return function(t){return!("showValue"in t)||t.showValue}(a)&&(i=tt),t.y+i})).attr("text-anchor","middle").attr("font-family",this.opt.polystat.fontType).attr("font-size",B+"px").attr("fill",this.opt.polystat.fontColor).style("pointer-events","none").text((function(t,e){var a=m[e];return E(a)?G?a.name.substring(0,W)+"...":a.name:""}));var st=0;rt.enter().append("text").attr("class",(function(t,e){return"valueLabel"+e})).attr("x",(function(t){return t.x+it})).attr("y",(function(t,e){var a=m[e],i=Z;return E(a)&&(i=K),t.y+i})).attr("text-anchor","middle").attr("font-family",this.opt.polystat.fontType).attr("fill",this.opt.polystat.fontColor).attr("font-size",j+"px").style("pointer-events","none").text((function(e,a){for(var i=0,o=t.data.length,r=null;null===r&&i<o;)r=t.formatValueContent(a,st+i,t),i++;return d.select("text.valueLabel"+a).attr("font-size",j+"px"),v.interval((function(){var e=d.select("text.valueLabel"+a),i=a;e.text((function(){e.attr("font-size",j+"px");for(var a=null,o=0,r=2*t.data.length;null===a&&o<r;)a=t.formatValueContent(i,st+o,t),o++;return null===a?"":(""===a&&(a=""),a)})),st++}),t.opt.animationSpeed),r}))},t.prototype.miscbin=function(t){for(var e=0;e<t.length;e++)t[e].x=t[e][0],t[e].y=t[e][1];return t},t.prototype.formatValueContent=function(t,e,a){var i=a.data[t];if(void 0===i)return"";if(i.hasOwnProperty("showValue")&&!i.showValue)return"";if(!i.hasOwnProperty("valueFormatted"))return"";switch(i.animateMode){case"all":break;case"triggered":if(i.thresholdLevel<1)return""}var o=i.valueFormatted;if(!o)return null;i.prefix&&i.prefix.length>0&&(o=i.prefix+" "+o),i.suffix&&i.suffix.length>0&&(o=o+" "+i.suffix);var r=i.members.length;if(r>0){var s=-1;if("all"===i.animateMode)s=e%r;else{void 0===i.triggerCache&&(i.triggerCache=this.buildTriggerCache(i));var n=e%i.triggerCache.length;s=i.triggerCache[n].index}var l=i.members[s];o=l.name+": "+l.valueFormatted,l.prefix&&l.prefix.length>0&&(o=l.prefix+" "+o),l.suffix&&l.suffix.length>0&&(o=o+" "+l.suffix)}if(o&&o.length>0)try{o=a.templateSrv.replaceWithText(o)}catch(t){console.log("ERROR: template server threw error: "+t)}return o},t.prototype.buildTriggerCache=function(t){for(var e=[],a=0;a<t.members.length;a++){var i=t.members[a];if(i.thresholdLevel>0){var o={index:a,name:i.name,value:i.value,thresholdLevel:i.thresholdLevel};e.push(o)}}return e=l.a.orderBy(e,["thresholdLevel","value","name"],["desc","desc","asc"])},t}();function F(t,e){var a=(e=e||{}).delimiter||".",i=e.maxDepth||3,o=1,r={};return function t(s,n){Object.keys(s).forEach((function(l){var h=s[l],p=e.safe&&Array.isArray(h),u="[object Object]"===Object.prototype.toString.call(h),c=n?n+a+l:l;if(e.maxDepth||(i=o+1),!p&&u&&Object.keys(h).length&&o<i)return++o,t(h,c);r[c]=h}))}(t,null),r}var k=function(){function t(t,e){if(null!==e){this.animateMode="all",this.displayMode="all",this.operatorName=t,this.name=e.alias;var a=this.getValueByOperator(t,e);this.value=a,this.valueFormatted=a,this.stats=e.stats,this.timestamp=e.datapoints[e.datapoints.length-1][1],this.prefix="",this.suffix="",this.seriesRaw=null,this.color="green",this.clickThrough="",this.sanitizedURL="",this.newTabEnabled=!0,this.sanitizeURLEnabled=!0,this.isComposite=!1,this.members=[],this.thresholdLevel=0,this.showName=!0,this.showValue=!0}}return t.prototype.getValueByOperator=function(t,e){var a=e.stats.avg;switch(t){case"avg":a=e.stats.avg;break;case"count":a=e.stats.count;break;case"current":a=e.stats.current;break;case"delta":a=e.stats.delta;break;case"diff":a=e.stats.diff;break;case"first":a=e.stats.first;break;case"logmin":a=e.stats.logmin;break;case"max":a=e.stats.max;break;case"min":a=e.stats.min;break;case"name":a=e.metricName;break;case"time_step":a=e.stats.timeStep;break;case"last_time":a=e.timestamp;break;case"total":a=e.stats.total;break;default:a=e.stats.avg}return a},t.prototype.shallowClone=function(){var e=new t(this.operatorName,null);return e.operatorName=this.operatorName,e.thresholdLevel=this.thresholdLevel,e.value=this.value,e.valueFormatted=this.valueFormatted,e.name=this.name,e.timestamp=this.timestamp,e.prefix=this.prefix,e.suffix=this.suffix,e.seriesRaw=null,e.color=this.color,e.clickThrough=this.clickThrough,e.newTabEnabled=this.newTabEnabled,e.sanitizedURL=this.sanitizedURL,e.sanitizeURLEnabled=this.sanitizeURLEnabled,e.isComposite=this.isComposite,e.members=[],e},t.prototype.deepClone=function(){var e=new t(this.operatorName,null);return e.operatorName=this.operatorName,e.thresholdLevel=this.thresholdLevel,e.value=this.value,e.valueFormatted=this.valueFormatted,e.name=this.name,e.timestamp=this.timestamp,e.prefix=this.prefix,e.suffix=this.suffix,e.seriesRaw=this.seriesRaw,e.color=this.color,e.clickThrough=this.clickThrough,e.sanitizedURL=this.sanitizedURL,e.newTabEnabled=this.newTabEnabled,e.sanitizeURLEnabled=this.sanitizeURLEnabled,e.isComposite=this.isComposite,e.members=[],e},t}(),L=function(){function t(){}return t.TimeSeriesToPolystat=function(t,e){return new k(t,e)},t.GetColumnsJSONData=function(t){if(!t||0===t.length)return[];for(var e={},a=0;a<t.length;a++){var i=t[a];if("docs"===i.type)for(var o=Math.min(i.datapoints.length,100),r=0;r<o;r++){var s=F(i.datapoints[r],null);for(var n in s)s.hasOwnProperty(n)&&(e[n]=!0)}}return l.a.map(e,(function(t,e){return{text:e,value:t}}))},t}();function z(t,e){var a=t,i=t.thresholdLevel,o=e.thresholdLevel;if(o>i&&(a=e),3===i)switch(o){case 1:case 2:a=e}return a}function P(t,e,a){var i=a;if(null===e)return{thresholdLevel:3,color:"#808080"};var o=-1;if(void 0===t)return{thresholdLevel:o,color:a};var r=t.length;if(0===r)return{thresholdLevel:o,color:a};var s=t[r-1];if(e>=s.value&&(o=s.state,i=s.color),1===t.length)return{thresholdLevel:o,color:i};for(var n=r-1;n>0;n--){var l=t[n],h=t[n-1];h.value<=e&&e<l.value&&o<h.state&&(o=h.state,i=h.color)}return-1===o&&(o=t[0].state,i=t[0].color),{thresholdLevel:o,color:i}}function _(t,e){var a=e.stats.avg;switch(t){case"avg":a=e.stats.avg;break;case"count":a=e.stats.count;break;case"current":a=e.stats.current;break;case"delta":a=e.stats.delta;break;case"diff":a=e.stats.diff;break;case"first":a=e.stats.first;break;case"logmin":a=e.stats.logmin;break;case"max":a=e.stats.max;break;case"min":a=e.stats.min;break;case"name":a=e.metricName;break;case"time_step":a=e.stats.timeStep;break;case"last_time":a=e.timestamp;break;case"total":a=e.stats.total;break;default:a=e.stats.avg}return a}var I=function(){function t(){}return t.tranformSingleMetric=function(t,e,a){if(isNaN(t))return e;for(var i=a[t];e.match(this.cellName);)e=e.replace(this.cellName,i.name);for(;e.match(this.cellValue);)e=e.replace(this.cellValue,encodeURIComponent(i.valueFormatted));for(;e.match(this.cellRawValue);)e=e.replace(this.cellRawValue,i.value.toString());return e},t.tranformNthMetric=function(t,e){for(;t.match(this.nthCellName);){if((o=t.match(this.nthCellName)).length>=2){var a=e[o[1]].name;t=t.replace(this.nthCellName,a)}}for(;t.match(this.nthCellValue);){if((o=t.match(this.nthCellValue)).length>=2){var i=e[o[1]].valueFormatted;t=t.replace(this.nthCellValue,encodeURIComponent(i))}}for(;t.match(this.nthCellRawValue);){var o;if((o=t.match(this.nthCellRawValue)).length>=2){i=e[o[1]].value;t=t.replace(this.nthCellRawValue,i.toString())}}return t},t.tranformComposite=function(t,e){for(;e.match(this.compositeName);)e=e.replace(this.compositeName,t);return e},t.cellName=/\${__cell_name}/,t.cellValue=/\${__cell}/,t.cellRawValue=/\${__cell:raw}/,t.nthCellName=/\${__cell_name_(\d+)}/,t.nthCellValue=/\${__cell_(\d+)}/,t.nthCellRawValue=/\${__cell_(\d+):raw}/,t.compositeName=/\${__composite_name}/,t}(),A=a(6),U=function(){function t(t,e,a,i){var o=this;this.onSetThresholds=function(t){console.log("OVERRIDE (threshold)",t)},this.$scope=t,this.$sanitize=a,this.templateSrv=e,this.activeOverrideIndex=0,this.suggestMetricNames=function(){return l.a.map(o.$scope.ctrl.series,(function(t){return t.alias}))},this.metricOverrides=i;for(var r=0;r<this.metricOverrides.length;r++)void 0===this.metricOverrides[r].label&&(this.metricOverrides[r].label="OVERRIDE "+(r+1))}return t.prototype.addMetricOverride=function(){var t=new D;t.label="OVERRIDE "+(this.metricOverrides.length+1),t.metricName="",t.thresholds=[],t.colors=["#299c46","#e5ac0e","#bf1b00","#4040a0"],t.decimals="",t.enabled=!0,t.unitFormat="short",t.clickThrough="",t.operatorName="avg",t.scaledDecimals=null,t.prefix="",t.suffix="",t.newTabEnabled=!0,t.sanitizeURLEnabled=!0,this.metricOverrides.push(t)},t.prototype.removeMetricOverride=function(t){this.metricOverrides=l.a.without(this.metricOverrides,t);for(var e=0;e<this.metricOverrides.length;e++)this.metricOverrides[e].label="OVERRIDE "+(e+1);this.$scope.ctrl.panel.savedOverrides=this.metricOverrides,this.$scope.ctrl.refresh()},t.prototype.metricNameChanged=function(t){console.log("metricNameChanged: '"+t.metricName+"'"),this.$scope.ctrl.refresh()},t.prototype.toggleHide=function(t){t.enabled=!t.enabled,this.$scope.ctrl.refresh()},t.prototype.matchOverride=function(t){for(var e=this.resolveOverrideTemplates(),a=0;a<e.length;a++){var i=e[a],o=Object(f.stringToJsRegex)(i.metricName),r=t.match(o);if(r&&r.length>0&&i.enabled)return e[a]}},t.prototype.resolveOverrideTemplates=function(){var t=this,e=[],a=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;return this.metricOverrides.forEach((function(i){var r=i.metricName.match(a);r&&r.length>0?r.forEach((function(a){t.templateSrv.replace(a,t.templateSrv.ScopedVars,"csv").split(",").forEach((function(t){var r=i.metricName.replace(a,t);e.push(o(o({},i),{metricName:r}))}))})):e.push(i)})),e},t.prototype.applyOverrides=function(t){for(var e=this.$scope.ctrl.panel.polystat,a=0;a<t.length;a++){var i=this.matchOverride(t[a].name);if(i){var o=t[a];o.operatorName=i.operatorName;var r=_(o.operatorName,o),s=P(i.thresholds&&i.thresholds.length?i.thresholds:e.globalThresholds,r,e.polygonGlobalFillColor);t[a].value=r,t[a].color=s.color,t[a].thresholdLevel=s.thresholdLevel;var n=Object(A.convertOldAngularValueMapping)(this.$scope.ctrl.panel),l=Object(f.getMappedValue)(n,t[a].value);if(l)t[a].valueFormatted=l.text;else{var h=c.a.valueFormats[i.unitFormat];h&&(t[a].valueFormatted=h(t[a].value,i.decimals,i.scaledDecimals),t[a].valueRounded=c.a.roundValue(t[a].value,i.decimals))}if(t[a].prefix=i.prefix,t[a].suffix=i.suffix,i.clickThrough&&i.clickThrough.length>0){var p=this.templateSrv.replaceWithText(i.clickThrough);p=I.tranformSingleMetric(a,p,t),p=I.tranformNthMetric(p,t),t[a].clickThrough=p,t[a].newTabEnabled=i.newTabEnabled,t[a].sanitizeURLEnabled=i.sanitizeURLEnabled,i.sanitizeURLEnabled&&(t[a].sanitizedURL=this.$sanitize(t[a].clickThrough))}}else if(e.globalThresholds&&e.globalThresholds.length){s=P(e.globalThresholds,t[a].value,e.polygonGlobalFillColor);t[a].color=s.color,t[a].thresholdLevel=s.thresholdLevel}}},t.prototype.setUnitFormat=function(t,e){t.unitFormat=e.value},t}(),V=function(){},H=function(){function t(t,e,a,i){var o=this;this.$scope=t,this.$sanitize=a,this.templateSrv=e,this.subTabIndex=0,this.suggestMetricNames=function(){return l.a.map(o.$scope.ctrl.series,(function(t){return t.alias}))},this.metricComposites=i;for(var r=0;r<this.metricComposites.length;r++)void 0===this.metricComposites[r].label&&(this.metricComposites[r].label="COMPOSITE "+(r+1))}return t.prototype.addMetricComposite=function(){var t=new V;t.label="COMPOSITE "+(this.metricComposites.length+1),t.compositeName="",t.members=[{}],t.enabled=!0,t.clickThrough="",t.hideMembers=!0,t.showName=!0,t.showValue=!0,t.animateMode="all",t.thresholdLevel=0,t.newTabEnabled=!0,t.sanitizeURLEnabled=!0,t.sanitizedURL="",this.metricComposites.push(t)},t.prototype.removeMetricComposite=function(t){this.metricComposites=l.a.without(this.metricComposites,t);for(var e=0;e<this.metricComposites.length;e++)this.metricComposites[e].label="COMPOSITE "+(e+1);this.$scope.ctrl.panel.savedComposites=this.metricComposites,this.$scope.ctrl.refresh()},t.prototype.addMetricToComposite=function(t){void 0===t.members?t.members=[{}]:t.members.push({}),this.$scope.ctrl.refresh()},t.prototype.removeMetricFromComposite=function(t,e){t.members=l.a.without(t.members,e),this.$scope.ctrl.refresh()},t.prototype.matchComposite=function(t){for(var e=0;e<this.metricComposites.length;e++){var a=this.metricComposites[e],i=Object(f.stringToJsRegex)(a.compositeName),o=t.match(i);if(o&&o.length>0&&a.enabled)return e}return-1},t.prototype.resolveCompositeTemplates=function(){var t=this,e=[];return this.metricComposites.forEach((function(a){t.templateSrv.replace(a.compositeName,t.templateSrv.ScopedVars,"csv").split(",").forEach((function(t){e.push(o(o({},a),{compositeName:t}))}))})),e},t.prototype.resolveMemberTemplates=function(t,e){var a=this;void 0===e&&(e=this.templateSrv.ScopedVars);var i=[],r=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;return t.forEach((function(t){if(t.seriesName){var s=t.seriesName.match(r);s&&s.length>0?s.forEach((function(r){a.templateSrv.replace(r,e,"csv").split(",").forEach((function(e){var a=t.seriesName.replace(s,e);i.push(o(o({},t),{seriesName:a}))}))})):i.push(t)}})),i},t.prototype.resolveMemberAliasTemplates=function(t,e){var a={};return e.forEach((function(t,e){a[e]={text:e,value:t}})),e.groups&&Object.keys(e.groups).forEach((function(t){a[t.replace(/\s+/g,"_")]={text:t,value:e.groups[t]}})),this.templateSrv.replace(t,a)},t.prototype.applyComposites=function(t){for(var e=[],a=[],i=this.resolveCompositeTemplates(),r=0;r<i.length;r++){var s=[],n=i[r];if(n.enabled){for(var h=null,p=this.resolveMemberTemplates(n.members,o(o({},this.templateSrv.ScopedVars),{compositeName:{text:"compositeName",value:n.compositeName}})),u=0;u<p.length;u++)for(var c=p[u],d=0;d<t.length;d++)if(void 0!==c.seriesName){var m=Object(f.stringToJsRegex)(c.seriesName).exec(t[d].name);if(m&&m.length>0){var v=t[d];if(c.alias&&c.alias.length>0&&(v.displayName=this.resolveMemberAliasTemplates(c.alias,m)),s.push(d),n.hideMembers&&e.push(d),n.clickThrough&&n.clickThrough.length>0){var g=this.templateSrv.replaceWithText(n.clickThrough);g=I.tranformComposite(n.compositeName,g),g=I.tranformSingleMetric(d,g,t),g=I.tranformNthMetric(g,t),v.clickThrough=g,v.sanitizedURL=this.$sanitize(g)}}}if(0!==s.length){for(var y=0;y<s.length;y++){v=t[x=s[y]];h=null===h?v:z(h,v)}if(null!==h){var b=h.shallowClone();b.name=n.compositeName;for(d=0;d<s.length;d++){var x=s[d];b.members.push(o(o({},t[x]),{name:t[x].displayName||t[x].name}))}b.thresholdLevel=h.thresholdLevel,b.showName=n.showName,b.showValue=n.showValue,b.animateMode=n.animateMode,b.newTabEnabled=n.newTabEnabled,b.sanitizeURLEnabled=n.sanitizeURLEnabled,b.isComposite=!0,a.push(b)}}}}Array.prototype.push.apply(t,a),e.sort((function(t,e){return e-t}));for(r=t.length;r>=0;r--)l.a.includes(e,r)&&t.splice(r,1);return t},t.prototype.metricNameChanged=function(t){this.$scope.ctrl.refresh()},t.prototype.toggleHide=function(t){t.enabled=!t.enabled,this.$scope.ctrl.refresh()},t}(),$=function(){function t(){}return t.generate=function(e,a,i){for(var o=[],r=0;r<a.length;r++){var s=e.ctrl.dashboard.formatDate(a[r].timestamp,"YYYY-MM-DD HH:mm:ss"),n="",h="",p="";if("triggered"===i.tooltipDisplayMode)if(0===t.getTriggeredCount(a[r])){i.tooltipTimestampEnabled&&(n='\n              <div class="polystat-panel-tooltip-time">'+s+"</div>\n            ");var u='\n          <div class="polystat-panel-tooltip-displaytext-empty-compositename">'+a[r].name+'</div>\n          <div class="polystat-panel-tooltip-displaytext-empty">'+i.tooltipDisplayTextTriggeredEmpty+"</div>\n          "+n+"\n          ";o.push(u);continue}i.tooltipTimestampEnabled&&(n='\n          <tr>\n            <td colspan="2" style="text-align: center;" class="graph-tooltip-time">'+s+"</td>\n          </tr>\n        ");var c="all"===a[r].displayMode?"":'\n        <tr>\n          <th colspan="2" style="text-align: center;">'+a[r].name+"</th>\n        </tr>\n      ";i.valueEnabled&&(h='\n        <th style="text-align: right;">Value</th>\n        ');var d=['\n        <table width="100%" class="polystat-panel-tooltiptable">\n        <thead>\n          '+c+'\n          <tr>\n            <th style="text-align: left;">Name</th>\n            '+h+"\n          </tr>\n        </thead>\n        <tfoot>\n          "+n+"\n        </tfoot>\n        <tbody>\n      "];if(a[r].members.length>0)for(var m=l.a.orderBy(a[r].members,[e.ctrl.panel.polystat.tooltipPrimarySortField,e.ctrl.panel.polystat.tooltipSecondarySortField],[e.ctrl.panel.polystat.tooltipPrimarySortDirection,e.ctrl.panel.polystat.tooltipSecondarySortDirection]),f=0;f<m.length;f++){var v=m[f];i.valueEnabled&&(p='\n            <td style="text-align: right; color: '+v.color+'">'+v.valueFormatted+"</td>\n            ");var g='\n            <tr>\n              <td style="text-align: left; color: '+v.color+'">'+v.name+"</td>\n              "+p+"\n            </tr>\n          ";switch(i.tooltipDisplayMode){case"triggered":0!==v.thresholdLevel&&d.push(g);break;default:d.push(g)}}else{i.valueEnabled&&(p='\n          <td style="text-align: right; color: '+a[r].color+'">'+a[r].valueFormatted+"</td>\n          ");g='\n        <tr>\n          <td style="text-align: left; color: '+a[r].color+'">'+a[r].name+"</td>\n          "+p+"\n        </tr>\n        ";switch(i.tooltipDisplayMode){case"triggered":0!==a[r].thresholdLevel&&d.push(g);break;default:d.push(g)}}d.push("</tbody></table>"),o.push(d.join("\n"))}return o},t.getTriggeredCount=function(t){var e=0;0!==t.thresholdLevel&&e++;for(var a=0;a<t.members.length;a++)0!==t.members[a].thresholdLevel&&e++;return e},t}(),B=function(t){function e(e,a,i,o){var r=t.call(this,e,a)||this;return r.$sanitize=o,r.animationModes=[{value:"all",text:"Show All"},{value:"triggered",text:"Show Triggered"}],r.displayModes=[{value:"all",text:"Show All"},{value:"triggered",text:"Show Triggered"}],r.shapes=[{value:"hexagon_pointed_top",text:"Hexagon Pointed Top"},{value:"circle",text:"Circle"},{value:"square",text:"Square"}],r.fontSizes=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70],r.unitFormats=c.a.getUnitFormats(),r.operatorOptions=[{value:"avg",text:"Average"},{value:"count",text:"Count"},{value:"current",text:"Current"},{value:"delta",text:"Delta"},{value:"diff",text:"Difference"},{value:"first",text:"First"},{value:"logmin",text:"Log Min"},{value:"max",text:"Max"},{value:"min",text:"Min"},{value:"name",text:"Name"},{value:"last_time",text:"Time of Last Point"},{value:"time_step",text:"Time Step"},{value:"total",text:"Total"}],r.sortDirections=[{value:"asc",text:"Ascending"},{value:"desc",text:"Descending"}],r.sortFields=[{value:"name",text:"Name"},{value:"thresholdLevel",text:"Threshold Level"},{value:"value",text:"Value"}],r.sortOptions=[{value:0,text:"Disabled"},{value:1,text:"Alphabetical (asc)"},{value:2,text:"Alphabetical (desc)"},{value:3,text:"Numerical (asc)"},{value:4,text:"Numerical (desc)"},{value:5,text:"Alphabetical (case-insensitive, asc)"},{value:6,text:"Alphabetical (case-insensitive, desc)"}],r.panelDefaults={savedComposites:[],savedOverrides:[],colors:["#299c46","#ED8128","#d44a3a","#4040a0"],valueMaps:[{value:"null",op:"=",text:"N/A"}],mappingTypes:[{name:"value to text",value:1},{name:"range to text",value:2}],rangeMaps:[{from:"null",to:"null",text:"N/A"}],mappingType:1,polystat:{animationSpeed:2500,columns:"",columnAutoSize:!0,displayLimit:100,defaultClickThrough:"",defaultClickThroughNewTab:!1,defaultClickThroughSanitize:!1,fontAutoScale:!0,fontSize:12,fontType:"Roboto",fontAutoColor:!0,globalUnitFormat:"short",globalDecimals:2,globalDisplayMode:"all",globalOperatorName:"avg",globalDisplayTextTriggeredEmpty:"OK",gradientEnabled:!0,hexagonSortByDirection:"asc",hexagonSortByField:"name",maxMetrics:0,polygonBorderSize:2,polygonBorderColor:"black",polygonGlobalFillColor:"#0a50a1",radius:"",radiusAutoSize:!0,rows:"",rowAutoSize:!0,shape:"hexagon_pointed_top",tooltipDisplayMode:"all",tooltipDisplayTextTriggeredEmpty:"OK",tooltipFontSize:12,tooltipFontType:"Roboto",tooltipPrimarySortDirection:"desc",tooltipPrimarySortField:"thresholdLevel",tooltipSecondarySortDirection:"desc",tooltipSecondarySortField:"value",tooltipTimestampEnabled:!0,tooltipEnabled:!0,valueEnabled:!0}},l.a.defaultsDeep(r.panel,r.panelDefaults),r.d3DivId="d3_svg_"+r.panel.id,r.containerDivId="container_"+r.d3DivId,r.initialized=!1,r.panelContainer=null,r.templateSrv=i,r.svgContainer=null,r.panelWidth=null,r.panelHeight=null,r.polystatData=[],r.d3Object=null,r.data=[],r.series=[],r.polystatData=[],r.tooltipContent=[],r.migrateSortDirections(),r.overridesCtrl=new U(e,i,o,r.panel.savedOverrides),r.compositesManager=new H(e,i,o,r.panel.savedComposites),void 0===f.PanelEvents?(r.events.on("data-received",r.onDataReceived.bind(r)),r.events.on("data-error",r.onDataError.bind(r)),r.events.on("data-snapshot-load",r.onDataReceived.bind(r)),r.events.on("init-edit-mode",r.onInitEditMode.bind(r))):(r.events.on(f.PanelEvents.dataReceived,r.onDataReceived.bind(r)),r.events.on(f.PanelEvents.dataError,r.onDataError.bind(r)),r.events.on(f.PanelEvents.dataSnapshotLoad,r.onDataReceived.bind(r)),r.events.on(f.PanelEvents.editModeInitialized,r.onInitEditMode.bind(r))),r}return e.$inject=["$scope","$injector","templateSrv","$sanitize"],function(t,e){function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}(e,t),e.prototype.migrateSortDirections=function(){"asc"===this.panel.polystat.hexagonSortByDirection&&(this.panel.polystat.hexagonSortByDirection=1),"desc"===this.panel.polystat.hexagonSortByDirection&&(this.panel.polystat.hexagonSortByDirection=2),"asc"===this.panel.polystat.tooltipPrimarySortDirection&&(this.panel.polystat.tooltipPrimarySortDirection=1),"desc"===this.panel.polystat.tooltipPrimarySortDirection&&(this.panel.polystat.tooltipPrimarySortDirection=2),"asc"===this.panel.polystat.tooltipSecondarySortDirection&&(this.panel.polystat.tooltipSecondarySortDirection=1),"desc"===this.panel.polystat.tooltipSecondarySortDirection&&(this.panel.polystat.tooltipSecondarySortDirection=2)},e.prototype.onInitEditMode=function(){var t="public/plugins/"+this.panel.type+"/",e=t+"partials/editor.options.html";this.addEditorTab("Options",e,2);var a=t+"partials/editor.overrides.html";this.addEditorTab("Overrides",a,3);var i=t+"partials/editor.composites.html";this.addEditorTab("Composites",i,4);var o=t+"partials/editor.mappings.html";this.addEditorTab("Value Mappings",o,5)},e.prototype.setContainer=function(t){this.panelContainer=t,this.svgContainer=t},e.prototype.getPanelWidthFailsafe=function(){var t=0;if(void 0!==this.panel.gridPos){var e=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/24;return t=Math.round(this.panel.gridPos.w*e)}if(void 0===this.panel.span)t=this.editModeInitiated?Math.max(document.documentElement.clientWidth,window.innerWidth):this.panelContainer.offsetParent.clientWidth;else{var a=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/12;t=Math.round(this.panel.span*a)}return t},e.prototype.getPanelHeight=function(){var t=this.panel.height;if(void 0===t||""===t){if(t=String(this.height),void 0!==this.panel.span){var e=20;""!==this.panel.title&&(e=42),t=String(this.containerHeight-e)}void 0===t&&void 0===(t=this.row.height)&&(t="250")}return t=t.replace("px",""),parseInt(t,10)},e.prototype.clearSVG=function(){p()("#"+this.d3DivId).length&&p()("#"+this.d3DivId).remove(),p()("#"+this.d3DivId+"-panel").length&&p()("#"+this.d3DivId+"-panel").remove(),p()("#"+this.d3DivId+"-tooltip").length&&p()("#"+this.d3DivId+"-tooltip").remove()},e.prototype.renderD3=function(){this.setValues(this.data),this.clearSVG(),0===this.panelWidth&&(this.panelWidth=this.getPanelWidthFailsafe()),this.panelHeight=this.getPanelHeight();var t={top:0,right:0,bottom:0,left:0},e=this.panelWidth,a=this.panelHeight;t.top=0,void 0!==this.panel.span&&""!==this.panel.title&&(t.top=7),t.bottom=0;var i=this.panel.polystat;void 0===i.polygonBorderSize&&(i.polygonBorderSize=0),void 0===i.polygonBorderColor&&(i.polygonBorderColor="black");var o={width:e,height:a,radius:i.radius,radiusAutoSize:i.radiusAutoSize,tooltipFontSize:i.tooltipFontSize,tooltipFontType:i.tooltipFontType,data:this.polystatData,displayLimit:i.displayLimit,globalDisplayMode:i.globalDisplayMode,columns:i.columns,columnAutoSize:i.columnAutoSize,rows:i.rows,rowAutoSize:i.rowAutoSize,tooltipContent:this.tooltipContent,animationSpeed:i.animationSpeed,defaultClickThrough:this.getDefaultClickThrough(NaN),polystat:i};this.d3Object=new O(this.templateSrv,this.svgContainer,this.d3DivId,o),this.d3Object.draw()},e.prototype.removeValueMap=function(t){var e=l.a.indexOf(this.panel.valueMaps,t);this.panel.valueMaps.splice(e,1),this.render()},e.prototype.addValueMap=function(){this.panel.valueMaps.push({value:"",op:"=",text:""})},e.prototype.removeRangeMap=function(t){var e=l.a.indexOf(this.panel.rangeMaps,t);this.panel.rangeMaps.splice(e,1),this.render()},e.prototype.addRangeMap=function(){this.panel.rangeMaps.push({from:"",to:"",text:""})},e.prototype.onThresholdsChanged=function(t){this.panel.refresh()},e.prototype.link=function(t,e,a,i){if(t&&a){var o=e.find(".grafana-d3-polystat");o.append('<div style="width: 100%; height: 100%;" id="'+i.containerDivId+'"></div>');var r=o[0].childNodes[0];i.setContainer(r),e=e.find(".grafana-d3-polystat");this.events.on(f.PanelEvents.render,(function(){i.panelWidth=e.width(),i.panelWidth=e.width(),i.renderD3(),i.renderingCompleted()}))}},e.prototype.setValues=function(t){this.dataRaw=t,this.dataRaw&&this.dataRaw.length&&("table"===this.dataRaw[0].type?this.panel.transform="table":"docs"===this.dataRaw[0].type?this.panel.transform="json":"table"!==this.panel.transform&&"json"!==this.panel.transform||(this.panel.transform="timeseries_to_rows"));var e=this.panel.polystat;if(this.polystatData.length=0,this.series&&this.series.length>0)for(var a=0;a<this.series.length;a++){var i=this.series[a],o=L.TimeSeriesToPolystat(e.globalOperatorName,i);this.polystatData.push(o)}this.applyGlobalFormatting(this.polystatData),this.polystatData=l.a.orderBy(this.polystatData,[e.hexagonSortByField],[this.panel.polystat.hexagonSortByDirection]),this.overridesCtrl.applyOverrides(this.polystatData),this.polystatData=this.compositesManager.applyComposites(this.polystatData);for(a=0;a<this.polystatData.length;a++)0===this.polystatData[a].clickThrough.length&&(this.polystatData[a].clickThrough=this.getDefaultClickThrough(a),this.polystatData[a].newTabEnabled=e.defaultClickThroughNewTab,this.polystatData[a].sanitizeURLEnabled=e.defaultClickThroughSanitize,this.polystatData[a].sanitizedURL=this.$sanitize(this.polystatData[a].clickThrough));this.polystatData=this.filterByGlobalDisplayMode(this.polystatData),this.polystatData=function(t,e,a){if(0===a)return t;var i=Math.ceil(a/2),o=a%2==0;if(1===i){var r=t[e];t=l.a.sortBy(t,r)}else 2===i?t=l.a.sortBy(t,(function(t){var a=t[e].match(/.*?(\d+).*/);return!a||a.length<2?-1:parseInt(a[1],10)})):3===i&&(t=l.a.sortBy(t,(function(t){return l.a.toLower(t[e])})));return o&&(t=t.reverse()),t}(this.polystatData,"name",this.panel.polystat.hexagonSortByDirection),this.polystatData=l.a.orderBy(this.polystatData,this.sortByField([this.panel.polystat.hexagonSortByField]),[this.panel.polystat.hexagonSortByDirection]),this.tooltipContent=$.generate(this.$scope,this.polystatData,e)},e.prototype.sortByField=function(t){return isNaN(t.name)?t.name:Number(t.name)},e.prototype.applyGlobalFormatting=function(t){for(var e=Object(A.convertOldAngularValueMapping)(this.panel),a=0;a<t.length;a++){var i=Object(f.getMappedValue)(e,t[a].value);if(i)t[a].valueFormatted=i.text;else{var o=c.a.valueFormats[this.panel.polystat.globalUnitFormat];if(o){var r=w(t[a].value,this.panel.polystat.globalDecimals);t[a].valueFormatted=o(t[a].value,r.decimals,r.scaledDecimals),t[a].valueRounded=c.a.roundValue(t[a].value,r.decimals)}}t[a].color=this.panel.polystat.polygonGlobalFillColor}},e.prototype.filterByGlobalDisplayMode=function(t){var e=[],a=[];if("all"!==this.panel.polystat.globalDisplayMode){for(var i=t.length,o=0;o<i;o++){var r=t[o];r.isComposite&&a.push(r),r.thresholdLevel<1&&e.push(o)}for(o=t.length;o>=0;o--)l.a.includes(e,o)&&t.splice(o,1);0===t.length&&a.length>0&&(t=a)}return t},e.prototype.onDataError=function(t){console.log(t),this.onDataReceived([]),this.render()},e.prototype.onDataReceived=function(t){this.series=t.map(this.seriesHandler.bind(this));var e={value:0,valueFormatted:0,valueRounded:0};this.setValues(e),this.data=e,this.render()},e.prototype.seriesHandler=function(t){var e=new m.a({datapoints:t.datapoints,alias:t.target});return e.flotpairs=e.getFlotPairs(this.panel.nullPointMode),e},e.prototype.invertColorOrder=function(){var t=this.panel.colors[0];this.panel.colors[0]=this.panel.colors[2],this.panel.colors[2]=t,this.render()},e.prototype.validateAnimationSpeed=function(){var t=this.panel.polystat.animationSpeed,e=5e3;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);e=a>=500?a:500}this.panel.polystat.animationSpeed=e,this.render()},e.prototype.validateDisplayLimit=function(){var t=this.panel.polystat.displayLimit,e=100;if(null===t)e=0;else if(!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>=0&&(e=a)}this.panel.polystat.displayLimit=0===e?"":e,this.render()},e.prototype.validateColumnValue=function(){if(this.panel.polystat.columnAutoSize)this.panel.polystat.columns="";else{var t=this.panel.polystat.columns,e=1;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.columns=e}this.render()},e.prototype.validateRowValue=function(){if(this.panel.polystat.rowAutoSize)this.panel.polystat.rows="";else{var t=this.panel.polystat.rows,e=1;if(t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.rows=e}this.render()},e.prototype.validateRadiusValue=function(){if(this.panel.polystat.radiusAutoSize)this.panel.polystat.radius="";else{var t=this.panel.polystat.radius,e=25;if(null!==t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>0&&(e=a)}this.panel.polystat.radius=e}this.render()},e.prototype.validateFontColorValue=function(){this.panel.polystat.fontAutoColor?this.panel.polystat.fontColor="":this.panel.polystat.fontColor||(this.panel.polystat.fontColor="black"),this.render()},e.prototype.validateBorderSizeValue=function(){var t=this.panel.polystat.polygonBorderSize,e=2;if(null!==t&&!isNaN(parseInt(t,10))){var a=parseInt(t,10);a>=0&&(e=a)}this.panel.polystat.polygonBorderSize=e,this.render()},e.prototype.updatePolygonBorderColor=function(){this.panel.polystat.polygonBorderColor=S(this.panel.polystat.polygonBorderColor),this.render()},e.prototype.updatePolygonGlobalFillColor=function(){this.panel.polystat.polygonGlobalFillColor=S(this.panel.polystat.polygonGlobalFillColor),this.render()},e.prototype.getDefaultClickThrough=function(t){var e=this.panel.polystat.defaultClickThrough;return e=I.tranformSingleMetric(t,e,this.polystatData),e=I.tranformNthMetric(e,this.polystatData),e=this.templateSrv.replaceWithText(e)},e.prototype.setGlobalUnitFormat=function(t){this.panel.polystat.globalUnitFormat=t.value},e.templateUrl="partials/template.html",e}(s.MetricsPanelCtrl),j=a(8),G=a.n(j),W=function(){function t(t){this.$scope=t,this.thresholdStates=[{value:0,text:"ok"},{value:1,text:"warning"},{value:2,text:"critical"},{value:3,text:"custom"}],this.thresholds=[],t.thresholds&&(this.thresholds=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}(t.thresholds))}return t.$inject=["$scope"],t.prototype.sortThresholds=function(){this.thresholds=l.a.orderBy(this.thresholds,["value"],["asc"])},t.prototype.doRefresh=function(){this.thresholds&&this.thresholds.length?this.$scope.thresholds=this.thresholds:this.$scope.thresholds=void 0,this.$scope.callback()},t.prototype.addThreshold=function(){this.thresholds.push({value:0,state:0,color:"#299c46"}),this.sortThresholds(),this.doRefresh()},t.prototype.setThresholdColor=function(t){t.color=S(t.color),this.doRefresh()},t.prototype.updateThresholdColor=function(t){var e=this.$scope.colors;t.color=e[t.state],this.doRefresh()},t.prototype.removeThreshold=function(t){this.thresholds=l.a.without(this.thresholds,t),this.sortThresholds(),this.doRefresh()},t}();G.a.directive("polyThresholds",(function(){return{controller:W,controllerAs:"ctrl",restrict:"E",scope:{thresholds:"=",colors:"=",override:"=?",callback:"&"},templateUrl:"./public/plugins/grafana-polystat-panel/partials/thresholds.html"}})),a.d(e,"PanelCtrl",(function(){return B})),Object(s.loadPluginCss)({dark:"plugins/grafana-polystat-panel/styles/dark.css",light:"plugins/grafana-polystat-panel/styles/light.css"})}])}));
//# sourceMappingURL=module.js.map